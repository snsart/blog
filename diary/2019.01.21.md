## [<<目录](https://github.com/snsart/blog/blob/master/README.md)

## MVVM
MVVM模式，模型(Model)、视图(View)、视图模型(ViewModel)，为视图层量身定做一套视图模型，并在视图模型中创建属性和方法，为视图层绑定数据并实现交互。

### 理解
在MVVM模式中，视图组件为html代码，html通过data-bind属性描述了此组件的类型和数据（Model），在viewModel中事先定义了创建各个组件的方法，在渲染页面时，VM会遍历页面中所有的dom，查找拥有data-bind属性的dom，并通过data-bind的描述进行渲染。在渲染组件时，需要用到两个参数，即组件所在的dom和组件需要的data，这里的data即为data-bind中描述的数据。由于模型是通过视图的data-bind进行绑定的，这就保证了模型改变时，渲染的视图也会随之改变。

### 视图模型对象
下面是MVVM中关键的视图模型对象：
```
var VM=function(){
	//Method中事先定义了各种组件
	var Method={
		//实例：进度条组件创建方法,通过data-bind中的type属性可以查找对应的函数；
		progressbar:function(dom,data){},
		//实例：滑动条组件创建方法
		slider:function(dom,data){}
	}
	
	//根据dom，获取data-bind数据
	function getBindData(dom){
		var data=dom.getAttribute('data-bind');
		return data&&(new Function("return ({"+data+"})"))();
	}
	
	return function(){
		var doms=document.body.getElementsByTagName('*'),
			ctx=null;
		//遍历所有的dom	
		for(var i=0;i<doms.length;i++){
			ctx=getBindData(doms[i]);
			//在Method中查找并渲染组件
			ctx.type&&Method[ctx.type]&&Method[ctx.type](doms[i],ctx);
		}
	}
	
}();
```

视图和数据模型如下：

```
<div class="first" data-bind="type:'slider',data:demo1"></div>
<div class="second" data-bind="type:'slider',data:demo1"></div>
<div class="third" data-bind="type:'progressbar',data:demo1"></div>

var demo1={
	position:60,
	totle:200	
},

demo2={
	position:20
},

demo3={
	position:50
}
```

渲染组件
```
window.onload=function(){
	VM();
}
```
