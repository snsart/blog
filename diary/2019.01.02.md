## [<<目录](https://github.com/snsart/blog/blob/master/README.md)

## 链模式：方法的链式调用
通过在对象方法中将当前对象返回，可以实现对同一个对象多个方法的链式调用。从而简化对该对象的多个方法的多次调用时，对该对象的多次引用。在jQuery中实现了链模式。<br>

下面我们可以定义一个链式调用的对象：
```javascript
var obj={
	func1:function(){
		//操作
		return this;
	},
	func2:function(){
		//操作
		return this;
	},
	func3:function(){
		//操作
		return this;
	}

}
```
因此可以这样调用obj的方法：
```javascript
obj.func1().func2().func3();
```

### jQuery实现过程中的一些问题分析

在jQuery可以获得dom中的元素，然后对元素进行链式操作，比如：
```javascript
jQuery(this).addClass("highlight").children("a").show();
```
需要先定义一个jQuery函数,然后把其他方法放入原型中:
```javascript
var jQuery=function(selector){
	
}
jQuery.prototype = {
	addClass:function(){
		//操作
		return this;
	},
	children:function(){
		//操作
		return this;
	},
	show:function(){
		//操作
		return this;
	}
}
```

由于jQuery(selector)也需要能够链式添加方法，而其他方法都在原型中，所以jQuery函数需要返回jQuery的原型：
```javascript
var jQuery=function(selector){
	return jQuery.prototype;
}
```

#### 处理参数
 
这里有一个问题，我们没有对参数selector做出处理，我们可以在原型中专门定义一个方法init，处理参数和进行初始化：
```javascript
jQuery.prototype = {
	init:function(selector){
		this[0]=document.getElementById(selector)//为方便其他方法使用，将获得的元素保存在this[0]中
		return this;
	}
	addClass:function(){
		//操作
		return this;
	},
	children:function(){
		//操作
		return this;
	},
	show:function(){
		//操作
		return this;
	}
}
```
同时，修改jQuery函数：
```javascript
var jQuery=function(selector){
	return jQuery.prototype.init(selector);
}
```

#### 覆盖问题
测试如下：
```javascript
var demo1=jQuery("id1");
var demo2=jQuery("id2");
```
我们发现demo2把demo1覆盖掉了，这是因为jQuery("id1")和jQuery("id2")调用的是同一个方法init，因此我们需要通过new来创建init,如下：
```javascript
var jQuery=function(selector){
	return new jQuery.prototype.init(selector);
}
```
但这样的话，jQuery("id1").addClass()将会报错，因为通过new创建的对象中的this指的对象本身，而不是jQuery.prototype，我们需要将init函数的原型指向jQuery.prototype，即。
```javascript
jQuery.prototype.init.prototype=jQuery.prototype;

```

#### 更灵活的添加扩展属性(或覆盖默认属性)的方式
在jQuery中定义了一个extend方法，可以更灵活的为对象添加链式方法：
```javascript
jQuery.extend=jQuery.prototype.extend=function(){
	var len=arguments.length,target=arguments[0],j;
	if(len==1){
		target=this;
	}
	for(var i=0;i<len;i++){
		for(j in arguments[i]){
			target[j]=arguments[i][j];
		}
	}
	return target;
}
```
这里参数如果为1个，则为jQuery或jQuery.prototype添加属性，否则为第一个参数添加属性，可以通过extend方法为原型添加attr方法，如下：
```javascript
jQuery.prototype.extend({
	attr:function(){
		for(var i=0,len=this.length;i<len;i++){
			var elem=this[i];
			//操作
		}
		return this;
	}
})
```



