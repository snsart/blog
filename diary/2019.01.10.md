## [<<目录](https://github.com/snsart/blog/blob/master/README.md)

### 对象表示模块
随着系统的增大，为了降低功能之间的耦合性，可以通过把解决某个功能的一些列方法封装起来，形成一个模块，我们可以用一个对象来封装这些方法：

```javascript
var model={
	_count:0,//使用到的数据
	fn1:function(){},
	fn2:function(){}
}
```
这样的写法虽然为一系列方法提供了统一的命名空间，但过度的暴露了内部的成员，内部状态可以直接被改写，比如：model._count=5;可以使用闭包来隐藏内部数据。

### 使用闭包隐藏内部数据

```javascript
var model=(function(){
	var _count:0;
	return {
		fn1:function(){},
		fn2:function(){}
	}
})();
```

### 为模块添加子模块
为了提升模块的组织性和复用性，一个大的模块应该包含一系列小的模块，小的模块由更小的模块组成，模块之间形成了一个树形结构。因此每个模块需要有添加子模块的功能。
```javascript
model.subModel=(function(){
	return {
		fn3:function(){},
		fn4:function(){}
	}
})();
```
### 模块管理器——创建模块的方法
随着模块的增多，上面创建模块的方式将变得非常低效，我们可以设计一个模块管理器来更方便的创建模块：
```javascript
var F=F||{};

/*
 @param str 模块路由，比如model.subModel
 @param fn 模块中的方法
 */
F=(function(){
	var model={};//所有模块的父模块
	return {
		define:function(str,fn){
			var parts=str.split('.'),
				old=parent=model,
				//模块层级及层级长度
				i=len=0,
			if(parts[0]==='F'){
				parts=parts.slice(1);
			}
			//屏蔽对define与module模块方法从重写
			if(parts[0]='define'||parts[0]==='module'){
				return;
			}
			//遍历模块并定义每层模块
			for(len=parts.length;i<len;i++){
				if(typeof parent[parts[i]]==='undefined'){
					parent[parts[i]]={};
				}
				old=parent;
				parent=parent[parts[i]];
			}
			if(fn){
				old[parts[--i]]=fn();
			}
			return model;
		}
	}

})();
```

测试：

```
F.define('model.submodel',function(){
	return {
		fn:function(){
			console.log("submodel");
		}
	}
})
```

上述方法，会创建如下的模块：

```
var model={};
model.submodel={
	fn:function(){
		console.log("submodel");
	}
}
```

### 模块管理器——使用模块的方法

由于模块属于F的私有变量，因此我们编写的函数无法直接使用模块，model方法需要从所有已定义的模块中查找出需要的模块，作为参数传递给需使用模块的函数；
```javascript
F=(function(){
	var model={};//所有模块的父模块
	return {
		define:function(str,fn){
			//...
		}
		
		//模块调用方法，前面的参数为调用的模块，最后一个参数为执行的方法
		model:function(){
			var args=[].slice.call(arguments),
				fn=args.pop(),
				//获取依赖模块，若args[0]是数组，则依赖模块为args[0]。否则依赖模块为args
				parts=args[0]&&args[0] instanceof Array?args[0]:args,
				modules=[],
				modIDs='',
				i=0,
				ilen=parts.length,
				parent,j,jlen;
				
			while(i<ilen){
				if(typeof parts[i]==="string"){
					parent=model;
					//类似"a.b.c"等参数形式，应只加入c模块；
					modeIDs=parts[i].split(".");
					for(j=0,jlen=modIDs.length;j<jlen;j++){
						parent=parent[modIDs[j]]||false;
					}
					modules.push(parent);
				}else{
					modules.push(parts[i]);
				}
				i++;
			}
			
			fn.apply(null,modules);
		}
	}

})();
```

测试如下：
```javascript
F.module('dom','string.strim',function(dom,trim){
	var html=dom('test').html();
	var str=trim(html);
});

```