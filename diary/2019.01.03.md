## [<<目录](https://github.com/snsart/blog/blob/master/README.md)

## 节流模式
短期内不断地执行重复操作，会影响程序性能，通过节流模式，可以使短期内相同的操作只执行最后一次。节流模式的实现思想分为两部分：1.为执行的函数设置延时执行时间t；2.在时间t内如果相同的函数再次被触发，则将上一次设置了延时执行函数的计时器清除，并为当前触发的函数设置延时计时器。<br>
举例：下面show函数用来在浏览器中显示返回顶部的按钮，要求是只有当scrollTop大于1000时才显示，由于我们要监听onscroll事件，因此在下面的实现中，当scrollTop大于1000时，滚动鼠标时show将被不断的触发，性能是很差的。
```javascript
document.body.onscroll = function() {
	if(document.documentElement.scrollTop >= 1000) {
		show();
	});
}
```
我们可以使用节流模式作如下修改：
```javascript
var timer=null;
document.body.onscroll = function() {
	if(document.documentElement.scrollTop >= 1000) {
		// 在高频率事件中想要执行一段代码最好使用节流器 ,因为这些代码只需要执行一次就可以不必多次执行
		// 先清除延时器 
		clearTimeout(timer);
		// 再赋值
		timer = setTimeout(function() {
			show();
		}, 200);
	}
}
```

### 封装：节流器
为了方便调用，这里我们实现了一个节流函数，节流函数有两个功能：1.为函数设置延时执行；2.取消函数的延时执行。我们通过判断节流函数第一个参数的类型来判断函数的功能，若第一个参数是boolen类型则功能为2（true：取消，false：不取消），否则为1。
```
var throttle=function(){
	var isClear=arguments[0],fn;
	if(typeof isClear==="boolean"){
		fn=arguments[1];
		//函数的计时器句柄存在，则清除该计时器
		fn.throttleID&&clearTimeout(fn.throttleID);
	}else{
		//第一个参数为函数
		fn=isClear;
		//第二个参数为函数执行时的参数
		param=arguments[1];
		//用param中的值替换context,time,args的默认值
		var p=extend({
			context:null,//函数执行的作用域
			time:300,
			args:[]
		},param);
		//1.清除执行函数句柄
		arguments.callee(true,fn);
		//2.为函数绑定计时器句柄
		fn.throttleID=setTimeout(function(){
			fn.apply(p.context,p.args);
		},p.time)
	}

}
```
extend方法如下：参见[2019.01.02](https://github.com/snsart/blog/blob/master/diary/2019.01.02.md)<br>
```javascript
var extend=function(){
	var len=arguments.length,target=arguments[0],j;
	if(len==1){
		target=this;
	}
	for(var i=0;i<len;i++){
		for(j in arguments[i]){
			target[j]=arguments[i][j];
		}
	}
	return target;
}
```

使用节流器，上面的实例可以改为：
```javascript
document.body.onscroll = function() {
	if(document.documentElement.scrollTop >= 1000) {
		throttle(show,{time:200});
	}
}
```

### 应用场景
1.优化浮层：比如当鼠标移入图标，出现二维码或图标说明，为了防止不小心移入，需要在鼠标移入时延时一段时间再显示二维码或说明。
2.图片延时加载：

注意：节流是一种设计思想，我们不仅可以通过时间进行节流，还可以通过数量，比如对异步请求应用节流，此时可以优化请求次数来节省资源。
