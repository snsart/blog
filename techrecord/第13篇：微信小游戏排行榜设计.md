一、如何获取好友关系链数据

wx.getFriendCloudStorage({
    keyList: ["score"],
    success: function (res) {
      var data = res.data;
      for (let i = 0; i < data.length; i++) {
        var obj = {
          key: i,
          name: data[i].nickname,
          url: data[i].avatarUrl,
          img: null,
          scroes: data[i].KVDataList.length == 0 ? 0 : data[i].KVDataList[0].value
        }
        totalGroup.push(obj);
      }
      totalGroup.sort(compare);
      for (let i = 0; i < totalGroup.length; i++) {
        const img = wx.createImage();
        img.src = totalGroup[i].url;
        totalGroup[i].img = img;
        totalGroup[i].key = i + 1;
      }
    },
    fail: function () {
      console.log("fail");
    }
})

二、如何更新好友关系数据

postMessage(data) {
        const openDataContext = wx.getOpenDataContext();
        openDataContext.postMessage(data);
    }

wx.setUserCloudStorage({
            KVDataList: [{
              key:"score",
              value:JSON.stringify(gameScoreData),
            },{
              key:"lastDate",
              value:dateTamp.week}
            ],

            success: function (res) {
              console.log('--success res:', res);
              resolve();
            },
            fail: function (res) {
              console.log('--fail res:', res);
            },
            complete: function (res) {
              console.log('--complete res:', res);
            },       
})

三、如何显示好友排行榜



四、定期清空数据
//判断是否时间戳是否是本周
function isCurrentWeek(timestamp){
  if(timestamp==undefined){
    return false;
  }
  var date=new Date();
  var day=date.getDay()==0?7:date.getDate();
  var hours=date.getHours();
  var minutes=date.getMinutes();
  var seconds = date.getSeconds();
  var timefromSunday=(day*24*3600+hours*3600+minutes*60+seconds)*1000;//星期日凌晨0点到此时的毫秒数
  var time=date.getTime()-timefromSunday;//1970年1月1人至上周日凌晨的毫秒数；
  console.log(time);
  return parseInt(timestamp)>time//若时间戳大于周日，则时间戳标志的事件发生在本周；
}



